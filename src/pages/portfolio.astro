 ---
 import { getCollection } from 'astro:content';
 import Layout from '../layouts/Layout.astro';
 import Icon from '../components/Icon/Icon.astro';

// Get all projects from the collection
const allProjects = await getCollection('projects');

// Sort projects by date (newest first)
const projects = allProjects.sort((a, b) => {
  return new Date(b.data.projectDate).getTime() - new Date(a.data.projectDate).getTime();
});
---

<Layout title="Portfolio" description="Explore my portfolio of software development and product management projects">
  <div class="portfolio-page">
     <section class="portfolio-hero">
       <div class="portfolio-header">
         <Icon name="Briefcase" size={48} weight="duotone" liquid={true} inkEffect="medium" />
         <h1>Portfolio</h1>
       </div>
       <p class="lead">Selected work and projects</p>
     </section>

    <section class="portfolio-grid">
      {projects.map(project => (
        <a href={`/portfolio/${project.slug}`} class="portfolio-item">
          <div class="portfolio-image">
            {project.data.projectImage && project.data.projectImage.startsWith('http') ? (
              <img
                src={`/api/screenshot?url=${encodeURIComponent(project.data.projectImage)}`}
                alt=""
                loading="lazy"
                class="portfolio-preview-img"
                onerror="this.onerror=null; this.parentElement.classList.add('fallback'); this.style.display='none'"
              />
            ) : (
              <div class="portfolio-placeholder">
                <span class="placeholder-logo">shupp.dev</span>
              </div>
            )}
            <div class="portfolio-overlay">
              <div class="overlay-content">
                <h3 class="overlay-title">{project.data.title}</h3>
                <p class="overlay-description">{project.data.description}</p>
                <div class="overlay-meta">
                  <span class="overlay-date">
                    {new Date(project.data.projectDate).getFullYear()}
                  </span>
                  <span class="overlay-cta">View Project →</span>
                </div>
              </div>
            </div>
          </div>
          <div class="portfolio-info">
            <h3 class="portfolio-title">{project.data.title}</h3>
            <p class="portfolio-tech-summary">
              {project.data.technologies.slice(0, 3).join(' • ')}
              {project.data.technologies.length > 3 && ` + ${project.data.technologies.length - 3} more`}
            </p>
          </div>
        </a>
      ))}
    </section>
  </div>
</Layout>

<style>
  .portfolio-page {
    max-width: 1200px;
    margin: 0 auto;
    padding: 4rem 1.5rem;
  }

    /* Hero Section */
    .portfolio-hero {
      margin-bottom: 3rem;
    }

   .portfolio-header {
     display: flex;
     align-items: center;
     gap: 1rem;
     margin-bottom: 0.75rem;
   }

   .portfolio-hero h1 {
     font-size: 2.5rem;
     font-weight: 700;
     margin: 0;
     color: var(--text-color);
   }

   .lead {
     font-size: 1.25rem;
     color: var(--text-light);
     line-height: 1.6;
     margin: 0;
   }

  /* Portfolio Grid */
  .portfolio-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
    gap: 2rem;
  }

  .portfolio-item {
    text-decoration: none;
    color: inherit;
    display: block;
    transition: transform 0.3s ease;
  }

  .portfolio-item:hover {
    transform: translateY(-4px);
  }

  /* Portfolio Image with Overlay */
  .portfolio-image {
    position: relative;
    width: 100%;
    height: 260px;
    overflow: hidden;
    border-radius: 0;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  /* Portfolio Placeholder */
  .portfolio-placeholder {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    position: relative;
  }

  html.dark .portfolio-placeholder {
    background: linear-gradient(135deg, #1e1e28 0%, #32324e 100%);
  }

  .portfolio-image.fallback::after {
    content: "shupp.dev";
    font-size: 2rem;
    font-weight: 500;
    font-family: var(--font-main-header);
    color: rgba(255, 255, 255, 0.9);
    letter-spacing: 0.15em;
    text-transform: lowercase;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 1;
  }

  html.dark .portfolio-image.fallback::after {
    color: rgba(255, 255, 255, 0.8);
  }

  .portfolio-image.fallback {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    position: relative;
  }

  html.dark .portfolio-image.fallback {
    background: linear-gradient(135deg, #1e1e28 0%, #32324e 100%);
  }

  .placeholder-logo {
    font-size: 2rem;
    font-weight: 500;
    font-family: var(--font-main-header);
    color: rgba(255, 255, 255, 0.9);
    letter-spacing: 0.15em;
    text-transform: lowercase;
    position: relative;
    z-index: 1;
  }

  html.dark .placeholder-logo {
    color: rgba(255, 255, 255, 0.8);
  }



  .portfolio-preview-img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    object-position: top center;
    transition: transform 0.6s ease, filter 0.3s ease;
  }

  .portfolio-item:hover .portfolio-preview-img {
    transform: scale(1.05);
    filter: blur(2px);
  }

  .portfolio-item:hover .portfolio-placeholder {
    transform: scale(1.05);
    filter: blur(2px);
  }

  .portfolio-item:hover .portfolio-image.fallback::after {
    transform: translate(-50%, -50%) scale(1.05);
    filter: blur(2px);
  }

  /* Overlay */
  .portfolio-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, rgba(59, 130, 246, 0.9), rgba(139, 92, 246, 0.9));
    opacity: 0;
    transition: opacity 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 2rem;
  }

  html.dark .portfolio-overlay {
    background: linear-gradient(135deg, rgba(30, 30, 40, 0.95), rgba(50, 50, 70, 0.95));
  }

  .portfolio-item:hover .portfolio-overlay {
    opacity: 1;
  }

  .overlay-content {
    text-align: center;
    color: white;
    max-width: 90%;
  }

  .overlay-title {
    font-size: 1.5rem;
    font-weight: 700;
    margin-bottom: 0.75rem;
  }

  .overlay-description {
    font-size: 0.95rem;
    line-height: 1.6;
    margin-bottom: 1.5rem;
    opacity: 0.95;
  }

  .overlay-meta {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 2rem;
  }

  .overlay-date {
    font-size: 0.9rem;
    opacity: 0.8;
  }

  .overlay-cta {
    font-weight: 600;
    font-size: 0.95rem;
    display: inline-flex;
    align-items: center;
    transition: transform 0.2s ease;
  }

  .portfolio-item:hover .overlay-cta {
    transform: translateX(5px);
  }

  /* Portfolio Info */
  .portfolio-info {
    padding: 1.25rem 1.5rem;
  }

  .portfolio-title {
    font-size: 1.25rem;
    font-weight: 600;
    margin-bottom: 0.5rem;
    color: var(--text-color);
  }

  .portfolio-tech-summary {
    font-size: 0.9rem;
    color: var(--text-light);
    line-height: 1.5;
    margin: 0;
    font-weight: 400;
  }

  html.dark .portfolio-tech-summary {
    color: #9ca3af;
  }

   /* Responsive */
   @media (max-width: 768px) {
     .portfolio-page {
       padding: 3rem 1rem;
     }

     .portfolio-header {
       flex-direction: column;
       text-align: center;
     }

     .portfolio-hero h1 {
       font-size: 2rem;
     }

    .portfolio-grid {
      grid-template-columns: 1fr;
      gap: 1.5rem;
    }

    .portfolio-image {
      height: 220px;
    }

    .overlay-title {
      font-size: 1.25rem;
    }

    .overlay-description {
      font-size: 0.9rem;
    }
  }
</style>